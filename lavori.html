<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EVENTCORE - Lavori</title>
  <link rel="stylesheet" href="shared.css" />
  <link rel="stylesheet" href="lavori.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%23000'/%3E%3Ccircle cx='50' cy='30' r='20' fill='%23fff'/%3E%3Ccircle cx='50' cy='70' r='20' fill='%23000'/%3E%3Ccircle cx='50' cy='30' r='5' fill='%23000'/%3E%3Ccircle cx='50' cy='70' r='5' fill='%23fff'/%3E%3C/svg%3E" />
  <script src="keepalive.js" defer></script>
</head>
<body>
  <header>
    <div class="header-container">
      <div class="header-title">
        <h1>EVENTCORE</h1>
      </div>
      <nav class="main-nav">
        <a href="index.html" class="nav-link">Dashboard</a>
        <a href="anagrafica.html" class="nav-link">Anagrafica</a>
        <a href="lavori.html" class="nav-link">Lavori</a>
        <a href="magazzino.html" class="nav-link">Magazzino</a>
      </nav>
    </div>
  </header>

  <main>
    <h2>Gestione Lavori</h2>
    
    <div class="jobs-container">
      <!-- TAB NAVIGATION -->
      <div class="tabs-navigation">
        <button class="tab-btn active" data-tab="new-job">Nuovo Lavoro</button>
        <button class="tab-btn" data-tab="job-list">Archivio Lavori</button>
      </div>

      <!-- TAB 1: NEW JOB -->
      <div id="new-job" class="tab-content active">
        <h3>Crea Nuovo Lavoro</h3>
        
        <!-- WIZARD INDICATOR -->
        <div class="wizard-indicator">
          <div class="wizard-step active" id="step-1-indicator">
            <div class="wizard-circle">1</div>
            <div class="wizard-label">Evento</div>
          </div>
          <div class="wizard-step" id="step-2-indicator">
            <div class="wizard-circle">2</div>
            <div class="wizard-label">Team</div>
          </div>
          <div class="wizard-step" id="step-3-indicator">
            <div class="wizard-circle">3</div>
            <div class="wizard-label">Dettagli</div>
          </div>
        </div>

        <form id="new-job-form" class="job-form">
          <!-- STEP 1: EVENTO -->
          <div class="wizard-step-content active" id="step-1">
            <div class="form-row">
              <div class="form-group">
                <label>Nome Evento *</label>
                <input type="text" id="job-name" placeholder="Es: Conferenza AV 2025" required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Data Inizio *</label>
                <input type="datetime-local" id="job-start-date" required>
              </div>
              <div class="form-group">
                <label>Data Fine *</label>
                <input type="datetime-local" id="job-end-date" required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Luogo *</label>
                <input type="text" id="job-location" placeholder="Es: Sala Conferenze Milano" required>
              </div>
            </div>
          </div>

          <!-- STEP 2: TEAM -->
          <div class="wizard-step-content" id="step-2">
            <div class="form-row">
              <div class="form-group">
                <label>Responsabile *</label>
                <select id="job-responsibile" required>
                  <option value="">-- Seleziona Responsabile --</option>
                </select>
                <button type="button" class="btn-small" onclick="openResponsibileModal()">+ Aggiungi</button>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Personale</label>
                <div id="personnel-list" class="multi-select hidden"></div>
                
                <!-- PERSONNEL DROPDOWN SEARCH -->
                <div class="personnel-search-container" id="personnel-search-container">
                  <input type="text" id="personnel-search" placeholder="Cerca personale..." class="personnel-search-input">
                  <div id="personnel-dropdown" class="personnel-dropdown">
                    <!-- Populated by JS -->
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- STEP 3: DETTAGLI -->
          <div class="wizard-step-content" id="step-3">
            <div class="form-row">
              <div class="form-group">
                <label>Materiali</label>
                <div id="materials-list" class="multi-select"></div>
                <button type="button" class="btn-small" onclick="openMaterialModal()">+ Aggiungi Materiale</button>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Note</label>
                <textarea id="job-notes" placeholder="Note aggiuntive..." rows="3"></textarea>
              </div>
            </div>
          </div>

          <!-- NAVIGATION BUTTONS -->
          <div class="form-actions">
            <button type="button" class="btn-secondary" id="btn-prev" onclick="previousStep()">← Indietro</button>
            <button type="button" class="btn-primary" id="btn-next" onclick="nextStep()">Prosegui →</button>
            <button type="submit" class="btn-primary" id="btn-submit" style="display: none;">Crea Lavoro</button>
          </div>
        </form>
      </div>

      <!-- TAB 2: JOB LIST -->
      <div id="job-list" class="tab-content">
        <h3>Archivio Lavori</h3>
        
        <!-- FILTRI ARCHIVIO -->
        <div class="archive-filters">
          <div class="filter-group">
            <label>Anni:</label>
            <div class="dropdown-filter">
              <button class="dropdown-btn" id="years-dropdown-btn">Seleziona Anni</button>
              <div class="dropdown-content" id="filter-years"></div>
            </div>
          </div>
          
          <div class="filter-group">
            <label>Mesi:</label>
            <div class="dropdown-filter">
              <button class="dropdown-btn" id="months-dropdown-btn">Seleziona Mesi</button>
              <div class="dropdown-content" id="filter-months"></div>
            </div>
          </div>
          
          <div class="filter-group">
            <label for="filter-search">Ricerca Nome:</label>
            <input type="text" id="filter-search" placeholder="Cerca per nome lavoro...">
          </div>
          
          <button class="btn-secondary" onclick="clearJobFilters()">Ripristina</button>
        </div>
        
        <div id="jobs-archive" class="jobs-list"></div>
      </div>
    </div>
  </main>

  <!-- MODAL: AGGIUNGI RESPONSABILE -->
  <div id="responsibile-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Aggiungi Responsabile</h2>
        <button class="modal-close-btn" onclick="closeResponsibileModal()">×</button>
      </div>
      <div class="modal-body">
        <form id="responsibile-modal-form">
          <div class="form-group">
            <label>Nome *</label>
            <input type="text" id="responsibile-modal-nome" placeholder="Nome" required>
          </div>
          <div class="form-group">
            <label>Cognome *</label>
            <input type="text" id="responsibile-modal-cognome" placeholder="Cognome" required>
          </div>
          <div class="form-group">
            <label>Email *</label>
            <input type="email" id="responsibile-modal-email" placeholder="Email" required>
          </div>
          <div class="form-group">
            <label>Telefono *</label>
            <input type="tel" id="responsibile-modal-phone" placeholder="Telefono" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeResponsibileModal()">Annulla</button>
        <button class="btn-primary" onclick="submitResponsibileModal()">Salva</button>
      </div>
    </div>
  </div>

  <!-- MODAL: DETTAGLI LAVORO -->
  <div id="job-details-modal" class="modal hidden">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2 id="job-details-title">Dettagli Lavoro</h2>
        <button class="modal-close-btn" onclick="closeJobDetailsModal()">×</button>
      </div>
      <div class="modal-body">
        <div id="job-details-content">
          <!-- Populated by JS -->
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-primary" onclick="editJob(currentJobId)">Modifica</button>
        <button class="btn-danger" onclick="deleteJobFromModal()">Elimina</button>
        <button class="btn-secondary" onclick="closeJobDetailsModal()">Chiudi</button>
      </div>
    </div>
  </div>

  <footer>
    <p>&copy; 2025 WideTech</p>
  </footer>

  <script src="navigation.js"></script>
  <script src="lavori.js"></script>
</body>
</html>
