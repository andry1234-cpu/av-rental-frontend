<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AV Rental - Lavori</title>
  <link rel="stylesheet" href="shared.css" />
  <link rel="stylesheet" href="lavori.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <script src="keepalive.js" defer></script>
</head>
<body>
  <header>
    <div class="header-container">
      <div class="header-title">
        <h1>AV RENTAL</h1>
      </div>
      <nav class="main-nav">
        <a href="index.html" class="nav-link">Dashboard</a>
        <a href="lavori.html" class="nav-link">Lavori</a>
        <a href="magazzino.html" class="nav-link">Magazzino</a>
      </nav>
    </div>
  </header>

  <main>
    <h2>Gestione Lavori</h2>
    
    <div class="jobs-container">
      <!-- TAB NAVIGATION -->
      <div class="tabs-navigation">
        <button class="tab-btn active" data-tab="new-job">Nuovo Lavoro</button>
        <button class="tab-btn" data-tab="job-list">Archivio Lavori</button>
        <button class="tab-btn" data-tab="manage-data">Gestisci Dati</button>
      </div>

      <!-- TAB 1: NEW JOB -->
      <div id="new-job" class="tab-content active">
        <h3>Crea Nuovo Lavoro</h3>
        
        <!-- WIZARD INDICATOR -->
        <div class="wizard-indicator">
          <div class="wizard-step active" id="step-1-indicator">
            <div class="wizard-circle">1</div>
            <div class="wizard-label">Evento</div>
          </div>
          <div class="wizard-step" id="step-2-indicator">
            <div class="wizard-circle">2</div>
            <div class="wizard-label">Team</div>
          </div>
          <div class="wizard-step" id="step-3-indicator">
            <div class="wizard-circle">3</div>
            <div class="wizard-label">Dettagli</div>
          </div>
        </div>

        <form id="new-job-form" class="job-form">
          <!-- STEP 1: EVENTO -->
          <div class="wizard-step-content active" id="step-1">
            <div class="form-row">
              <div class="form-group">
                <label>Nome Evento *</label>
                <input type="text" id="job-name" placeholder="Es: Conferenza AV 2025" required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Data Inizio *</label>
                <input type="datetime-local" id="job-start-date" required>
              </div>
              <div class="form-group">
                <label>Data Fine *</label>
                <input type="datetime-local" id="job-end-date" required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Luogo *</label>
                <input type="text" id="job-location" placeholder="Es: Sala Conferenze Milano" required>
              </div>
            </div>
          </div>

          <!-- STEP 2: TEAM -->
          <div class="wizard-step-content" id="step-2">
            <div class="form-row">
              <div class="form-group">
                <label>Responsabile *</label>
                <select id="job-responsibile" required>
                  <option value="">-- Seleziona Responsabile --</option>
                </select>
                <button type="button" class="btn-small" onclick="openResponsibileModal()">+ Aggiungi</button>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Personale</label>
                <div id="personnel-list" class="multi-select"></div>
                
                <!-- PERSONNEL DROPDOWN SEARCH -->
                <div class="personnel-search-container">
                  <input type="text" id="personnel-search" placeholder="Cerca personale..." class="personnel-search-input">
                  <div id="personnel-dropdown" class="personnel-dropdown">
                    <!-- Populated by JS -->
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- STEP 3: DETTAGLI -->
          <div class="wizard-step-content" id="step-3">
            <div class="form-row">
              <div class="form-group">
                <label>Materiali</label>
                <div id="materials-list" class="multi-select"></div>
                <button type="button" class="btn-small" onclick="openMaterialModal()">+ Aggiungi Materiale</button>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Note</label>
                <textarea id="job-notes" placeholder="Note aggiuntive..." rows="3"></textarea>
              </div>
            </div>
          </div>

          <!-- NAVIGATION BUTTONS -->
          <div class="form-actions">
            <button type="button" class="btn-secondary" id="btn-prev" style="display: none;" onclick="previousStep()">← Indietro</button>
            <button type="button" class="btn-primary" id="btn-next" onclick="nextStep()">Prosegui →</button>
            <button type="submit" class="btn-primary" id="btn-submit" style="display: none;">Crea Lavoro</button>
          </div>
        </form>
      </div>

      <!-- TAB 2: JOB LIST -->
      <div id="job-list" class="tab-content">
        <h3>Archivio Lavori</h3>
        
        <!-- FILTRI ARCHIVIO -->
        <div class="archive-filters">
          <div class="filter-group">
            <label>Anni:</label>
            <div class="dropdown-filter">
              <button class="dropdown-btn" id="years-dropdown-btn">Seleziona Anni</button>
              <div class="dropdown-content" id="filter-years"></div>
            </div>
          </div>
          
          <div class="filter-group">
            <label>Mesi:</label>
            <div class="dropdown-filter">
              <button class="dropdown-btn" id="months-dropdown-btn">Seleziona Mesi</button>
              <div class="dropdown-content" id="filter-months"></div>
            </div>
          </div>
          
          <div class="filter-group">
            <label for="filter-search">Ricerca Nome:</label>
            <input type="text" id="filter-search" placeholder="Cerca per nome lavoro...">
          </div>
          
          <button class="btn-secondary" onclick="clearJobFilters()">Ripristina</button>
        </div>
        
        <div id="jobs-archive" class="jobs-list"></div>
      </div>

      <!-- TAB 3: MANAGE DATA -->
      <div id="manage-data" class="tab-content">
        <h3>Gestisci Dati</h3>
        
        <div class="data-sections">
          <!-- RESPONSABILI -->
          <section class="data-section">
            <h4>Responsabili</h4>
            <div class="data-section-content">
              <form id="responsibile-form" class="quick-form">
                <input type="text" id="resp-name" placeholder="Nome Responsabile" required>
                <input type="email" id="resp-email" placeholder="Email" required>
                <input type="tel" id="resp-phone" placeholder="Telefono" required>
                <button type="submit" class="btn-small">Aggiungi</button>
              </form>
              <div id="responsibili-list" class="data-list"></div>
            </div>
          </section>

          <!-- PERSONALE -->
          <section class="data-section">
            <h4>Personale</h4>
            <div class="data-section-content">
              <form id="personnel-form" class="quick-form">
                <input type="text" id="pers-name" placeholder="Nome Personale" required>
                <input type="text" id="pers-role" placeholder="Ruolo (Tecnico, Operatore, etc.)" required>
                <input type="email" id="pers-email" placeholder="Email" required>
                <input type="tel" id="pers-phone" placeholder="Telefono" required>
                <button type="submit" class="btn-small">Aggiungi</button>
              </form>
              <div id="personnel-list-admin" class="data-list"></div>
            </div>
          </section>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 WideTech</p>
  </footer>

  <script src="navigation.js"></script>
  <script src="lavori.js"></script>
</body>
</html>
